# SerialPlot å¼€å‘è€…å¿«é€Ÿå‚è€ƒ

æœ¬æ–‡æ¡£ä¸ºå¼€å‘è€…æä¾›å¿«é€ŸæŸ¥è¯¢å’Œå¼€å‘æŒ‡å—ã€‚

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

1. **[ä»£ç æ¶æ„æ–‡æ¡£.md](./ä»£ç æ¶æ„æ–‡æ¡£.md)** - å®Œæ•´çš„æ¶æ„è®¾è®¡è¯´æ˜
2. **[srcä»£ç ç»„ç»‡.md](./srcä»£ç ç»„ç»‡.md)** - æ‰€æœ‰æºæ–‡ä»¶çš„è¯¦ç»†åˆ†ç±»
3. **[æ¶æ„å›¾ç¤º.md](./æ¶æ„å›¾ç¤º.md)** - å¯è§†åŒ–æ¶æ„å›¾å’Œæµç¨‹å›¾
4. **[å¼€å‘æ—¥å¿—.md](./å¼€å‘æ—¥å¿—.md)** - å¼€å‘è®°å½•å’Œé…ç½®è¯´æ˜

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ„å»ºé¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/hyOzd/serialplot
cd serialplot

# åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# é…ç½® (Qwtè‡ªåŠ¨ä¸‹è½½)
cmake ..

# æˆ–è€…ä½¿ç”¨ç³»ç»ŸQwt
cmake -DBUILD_QWT=false ..

# ç¼–è¯‘
make -j

# è¿è¡Œ
./serialplot
```

### å¯ç”¨æµ‹è¯•

```bash
cmake -DENABLE_TESTS=true ..
make check
```

---

## ğŸ”§ å¸¸ç”¨å¼€å‘ä»»åŠ¡

### 1. æ·»åŠ æ–°çš„æ•°æ®æ ¼å¼æ”¯æŒ

**æ­¥éª¤**:

1. **åˆ›å»ºReaderç±»** (ç»§æ‰¿AbstractReader)

```cpp
// newreader.h
class NewReader : public AbstractReader
{
    Q_OBJECT
public:
    NewReader(QIODevice* device, QObject* parent = 0);
    QWidget* settingsWidget() override;
    
protected:
    unsigned readData() override;
    
private:
    // ä½ çš„è§£æé€»è¾‘
};
```

2. **åˆ›å»ºè®¾ç½®ç•Œé¢**

```cpp
// newreadersettings.h
class NewReaderSettings : public QWidget
{
    Q_OBJECT
public:
    NewReaderSettings(QWidget* parent = 0);
    // é…ç½®æ¥å£
};
```

3. **åœ¨DataFormatPanelä¸­æ³¨å†Œ**

```cpp
// dataformatpanel.cpp
reader = new NewReader(&serialPort);
```

4. **æ›´æ–°CMakeLists.txt**

```cmake
qt_add_executable(${PROGRAM_NAME} WIN32
  # ... ç°æœ‰æ–‡ä»¶
  src/newreader.cpp
  src/newreadersettings.cpp
  )
```

### 2. æ·»åŠ æ–°çš„æ•°æ®å¤„ç†åŠŸèƒ½

**åˆ›å»ºæ–°çš„Sink**:

```cpp
class MyProcessor : public QObject, public Sink
{
    Q_OBJECT
protected:
    void feedIn(const SamplePack& data) override
    {
        // å¤„ç†æ•°æ®
        // ...
        
        // å¯é€‰ï¼šä¼ é€’ç»™followers
        Sink::feedIn(data);
    }
};

// ä½¿ç”¨
MyProcessor processor;
stream.connectFollower(&processor);
```

### 3. è‡ªå®šä¹‰ç»˜å›¾æ˜¾ç¤º

**ç»§æ‰¿Plotç±»**:

```cpp
class CustomPlot : public Plot
{
public:
    CustomPlot(QWidget* parent = 0);
    
    // é‡å†™ç»˜å›¾æ–¹æ³•
    // æ·»åŠ è‡ªå®šä¹‰ç»˜å›¾é¡¹
};
```

### 4. æ·»åŠ æ–°çš„å¯¼å‡ºæ ¼å¼

**æ‰©å±•DataRecorderæˆ–åˆ›å»ºæ–°ç±»**:

```cpp
class JsonExporter : public QObject, public Sink
{
protected:
    void feedIn(const SamplePack& data) override;
    
public:
    void exportToJson(QString filename);
};
```

---

## ğŸ“‹ å…³é”®æ¥å£é€ŸæŸ¥

### Sourceæ¥å£

```cpp
class Source
{
public:
    virtual bool hasX() const = 0;
    virtual unsigned numChannels() const = 0;
    void connectSink(Sink* sink);
    
protected:
    void feedOut(const SamplePack& data) const;
    void updateNumChannels() const;
};
```

### Sinkæ¥å£

```cpp
class Sink
{
protected:
    virtual void feedIn(const SamplePack& data);
    virtual void setNumChannels(unsigned nc, bool x);
    
public:
    void connectFollower(Sink* sink);
    Source* connectedSource();
};
```

### AbstractReaderæ ¸å¿ƒæ–¹æ³•

```cpp
class AbstractReader : public QObject, public Source
{
public:
    virtual QWidget* settingsWidget() = 0;
    virtual void enable(bool enabled = true);
    void pause(bool paused);
    
protected:
    virtual unsigned readData() = 0;  // å®ç°æ­¤æ–¹æ³•
    QIODevice* _device;               // ä»è¿™é‡Œè¯»å–
    bool paused;                      // æ£€æŸ¥æ˜¯å¦æš‚åœ
};
```

### FrameBufferæ¥å£

```cpp
class FrameBuffer
{
public:
    virtual unsigned size() const = 0;
    virtual double sample(unsigned i) const = 0;
    virtual Range limits() const = 0;
};

class WFrameBuffer : public ResizableBuffer
{
    virtual void addSamples(double* samples, unsigned n) = 0;
    virtual void resize(unsigned n) = 0;
    virtual void clear() = 0;
};
```

---

## ğŸ¨ Qtä¿¡å·æ§½è¿æ¥ç¤ºä¾‹

### å¸¸ç”¨è¿æ¥

```cpp
// ä¸²å£çŠ¶æ€å˜åŒ–
connect(&portControl, &PortControl::portToggled,
        this, &MainWindow::onPortToggled);

// æ•°æ®æ›´æ–°
connect(&stream, &Stream::dataAdded,
        plotMan, &PlotManager::replot);

// é€šé“æ•°å˜åŒ–
connect(&stream, &Stream::numChannelsChanged,
        this, &MainWindow::onNumChannelsChanged);

// æ ·æœ¬æ•°å˜åŒ–
connect(&plotControlPanel, &PlotControlPanel::numOfSamplesChanged,
        this, &MainWindow::onNumOfSamplesChanged);
```

---

## ğŸ“¦ ä¸»è¦æ•°æ®ç»“æ„

### SamplePack

```cpp
class SamplePack
{
public:
    unsigned numChannels() const;
    unsigned numSamples() const;
    const double* data(unsigned channel) const;
    // ...
};
```

### StreamChannel

```cpp
class StreamChannel
{
public:
    const FrameBuffer* yData() const;
    const XFrameBuffer* xData() const;
    QString name() const;
    QColor color() const;
    bool visible() const;
    // ...
};
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨Qtæ¶ˆæ¯è¾“å‡º

```cpp
// main.cpp ä¸­å·²ç»è®¾ç½®äº†è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†å™¨
qDebug() << "Your debug message";
qWarning() << "Warning message";
qCritical() << "Error message";
```

### 2. æŸ¥çœ‹æ•°æ®æµ

åœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—:

```cpp
// AbstractReader::onDataReady()
unsigned AbstractReader::readData()
{
    qDebug() << "Reading data...";
    // ...
}

// Stream::feedIn()
void Stream::feedIn(const SamplePack& pack)
{
    qDebug() << "Received" << pack.numSamples() 
             << "samples for" << pack.numChannels() << "channels";
    // ...
}
```

### 3. ä½¿ç”¨Demo Readeræµ‹è¯•

```cpp
// ä¸éœ€è¦çœŸå®ä¸²å£ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®
DemoReader* reader = new DemoReader(nullptr);
reader->connectSink(&stream);
reader->enable(true);
```

### 4. å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•
cd build
./TestReaders
./TestRecorder
./Test
```

---

## âš™ï¸ é…ç½®é¡¹è¯´æ˜

### QSettingsé”®å®šä¹‰ (setting_defines.h)

```cpp
// ä¸²å£è®¾ç½®
#define SETTING_PORT_NAME "port/name"
#define SETTING_BAUD_RATE "port/baudrate"

// æ•°æ®æ ¼å¼
#define SETTING_NUM_CHANNELS "numOfChannels"
#define SETTING_READER_TYPE "readerType"

// ç»˜å›¾
#define SETTING_NUM_SAMPLES "numOfSamples"
#define SETTING_PLOT_WIDTH "plotWidth"
#define SETTING_AUTO_SCALE "plot/autoScale"
```

### ä½¿ç”¨ç¤ºä¾‹

```cpp
QSettings settings;

// ä¿å­˜
settings.setValue(SETTING_PORT_NAME, portName);

// åŠ è½½
QString portName = settings.value(SETTING_PORT_NAME, "COM1").toString();
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¼“å†²åŒºå¤§å°

```cpp
// è¾ƒå°çš„ç¼“å†²åŒº = æ›´å°‘çš„å†…å­˜ï¼Œä½†å¯èƒ½ä¸¢å¤±æ—§æ•°æ®
stream.setNumSamples(1000);  // é»˜è®¤

// è¾ƒå¤§çš„ç¼“å†²åŒº = æ›´å¤šå†å²æ•°æ®
stream.setNumSamples(10000);
```

### 2. ç»˜å›¾æ›´æ–°é¢‘ç‡

```cpp
// é™ä½ç»˜å›¾é¢‘ç‡ä»¥æå‡æ€§èƒ½
// å¯ä»¥åœ¨PlotManagerä¸­æ·»åŠ å®šæ—¶å™¨æ§åˆ¶reploté¢‘ç‡
QTimer* updateTimer = new QTimer(this);
updateTimer->setInterval(50);  // 50ms = 20fps
connect(updateTimer, &QTimer::timeout, plotMan, &PlotManager::replot);
```

### 3. é€šé“æ•°é™åˆ¶

è¿‡å¤šé€šé“ä¼šå½±å“æ€§èƒ½ï¼Œå»ºè®®:
- å•å›¾æ¨¡å¼: < 10ä¸ªé€šé“
- å¤šå›¾æ¨¡å¼: < 20ä¸ªé€šé“

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘é”™è¯¯ - Qwtæ‰¾ä¸åˆ°

**A**: ç¡®ä¿å®‰è£…äº†Qwtæˆ–ä½¿ç”¨è‡ªåŠ¨æ„å»º:

```bash
cmake -DBUILD_QWT=true ..
```

### Q2: ä¸²å£æ— æ³•æ‰“å¼€

**A**: æ£€æŸ¥æƒé™ (Linux):

```bash
sudo usermod -a -G dialout $USER
# é‡æ–°ç™»å½•
```

### Q3: æ•°æ®æ˜¾ç¤ºä¸æ­£ç¡®

**A**: æ£€æŸ¥:
1. æ•°æ®æ ¼å¼è®¾ç½® (äºŒè¿›åˆ¶/ASCII)
2. å­—èŠ‚åºè®¾ç½® (å¤§ç«¯/å°ç«¯)
3. é€šé“æ•°é…ç½®
4. æ³¢ç‰¹ç‡åŒ¹é…

### Q4: å†…å­˜å ç”¨è¿‡é«˜

**A**: å‡å°ç¼“å†²åŒºå¤§å°:

```cpp
stream.setNumSamples(1000);  // å‡å°æ ·æœ¬æ•°
```

---

## ğŸ“– ä»£ç è§„èŒƒ

### å‘½åçº¦å®š

```cpp
// ç±»å: PascalCase
class MyClassName { };

// æ–‡ä»¶å: ä¸ç±»åå¯¹åº”ï¼Œå°å†™
// myfilename.h, myfilename.cpp

// ç§æœ‰æˆå‘˜: ä¸‹åˆ’çº¿å‰ç¼€
private:
    int _myPrivateVar;
    QWidget* _myWidget;

// ä¿¡å·/æ§½: åŠ¨è¯å¼€å¤´
signals:
    void dataReceived();
    
private slots:
    void onButtonClicked();
```

### å¤´æ–‡ä»¶ä¿æŠ¤

```cpp
#ifndef MYCLASS_H
#define MYCLASS_H

// ...

#endif // MYCLASS_H
```

### æ–‡ä»¶å¤´æ³¨é‡Š

```cpp
/*
  Copyright Â© 2025 Your Name

  This file is part of serialplot.

  serialplot is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  ...
*/
```

---

## ğŸ”— æœ‰ç”¨çš„èµ„æº

### Qtæ–‡æ¡£
- [Qt 6 Documentation](https://doc.qt.io/qt-6/)
- [QSerialPort](https://doc.qt.io/qt-6/qserialport.html)
- [Signals & Slots](https://doc.qt.io/qt-6/signalsandslots.html)

### Qwtæ–‡æ¡£
- [Qwt User's Guide](https://qwt.sourceforge.io/qwtdoc/index.html)
- [Qwt Examples](https://qwt.sourceforge.io/qwtdoc/examples.html)

### CMake
- [CMake Tutorial](https://cmake.org/cmake/help/latest/guide/tutorial/index.html)

---

## ğŸ“ æäº¤ä»£ç æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰æ£€æŸ¥:

- [ ] ä»£ç å·²ç¼–è¯‘é€šè¿‡
- [ ] æ²¡æœ‰ç¼–è¯‘è­¦å‘Š
- [ ] ç›¸å…³æµ‹è¯•å·²é€šè¿‡
- [ ] ä»£ç é£æ ¼ä¸€è‡´
- [ ] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Š
- [ ] æ›´æ–°äº†æ–‡æ¡£ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ²¡æœ‰è°ƒè¯•è¾“å‡ºé—ç•™
- [ ] é…ç½®æ–‡ä»¶å…¼å®¹æ€§æ£€æŸ¥

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ä½¿ç”¨ä¿¡å·æ§½è€Œä¸æ˜¯ç›´æ¥è°ƒç”¨**
   - ä¿æŒæ¨¡å—è§£è€¦
   - ä¾¿äºæœªæ¥æ‰©å±•

2. **é¿å…åœ¨Readerä¸­åšé‡è®¡ç®—**
   - ä¿æŒreadData()è½»é‡
   - å¤æ‚å¤„ç†æ”¾åˆ°Sinkä¸­

3. **åˆç†ä½¿ç”¨ç¼“å­˜**
   - ä¾‹å¦‚RingBufferçš„limitsç¼“å­˜
   - é¿å…é‡å¤è®¡ç®—

4. **é”™è¯¯å¤„ç†**
   - ä½¿ç”¨qWarning/qCriticalè®°å½•é”™è¯¯
   - ä¸è¦è®©å¼‚å¸¸å´©æºƒç¨‹åº

5. **å†…å­˜ç®¡ç†**
   - ä½¿ç”¨Qtçš„çˆ¶å­å…³ç³»ç®¡ç†
   - é¿å…å†…å­˜æ³„æ¼

---

## ğŸ“ å­¦ä¹ è·¯å¾„

### å…¥é—¨ (1-2å‘¨)
1. é˜…è¯»[ä»£ç æ¶æ„æ–‡æ¡£.md](./ä»£ç æ¶æ„æ–‡æ¡£.md)
2. æµè§ˆ[srcä»£ç ç»„ç»‡.md](./srcä»£ç ç»„ç»‡.md)
3. ç¼–è¯‘è¿è¡Œé¡¹ç›®
4. å°è¯•ä½¿ç”¨Demo Reader

### è¿›é˜¶ (2-4å‘¨)
1. ç†è§£Source-Sinkæ•°æ®æµ
2. é˜…è¯»å…³é”®ç±»çš„å®ç°
3. è¿è¡Œå’Œç†è§£å•å…ƒæµ‹è¯•
4. å®ç°ä¸€ä¸ªç®€å•çš„Reader

### ç²¾é€š (1-2æœˆ)
1. æ·±å…¥Qtä¿¡å·æ§½æœºåˆ¶
2. ç ”ç©¶Qwtç»˜å›¾åº“
3. ä¼˜åŒ–æ€§èƒ½
4. è´¡çŒ®ä»£ç 

---

## ğŸ“¬ è·å–å¸®åŠ©

- **GitHub Issues**: æŠ¥å‘ŠBugæˆ–è¯·æ±‚åŠŸèƒ½
- **ä»£ç æ³¨é‡Š**: å¤§å¤šæ•°ç±»éƒ½æœ‰è¯¦ç»†æ³¨é‡Š
- **ç¤ºä¾‹ä»£ç **: tests/ç›®å½•ä¸­çš„æµ‹è¯•ä»£ç 

---

ç¥å¼€å‘æ„‰å¿«! ğŸ‰
