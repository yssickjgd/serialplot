# 开发日志

## 0 配环境

- QT正常配置

- QWT需要在sourceforge里下载安装, 用Qt Creator编译后做如下操作

  ```makefile
  # need to compile qwt module and copy to dirs like below
  # C:\Qt\6.10.1\mingw_64\bin, dll_files
  # C:\Qt\6.10.1\mingw_64\lib, archive_files
  LIBS += -L$$[QT_INSTALL_LIBS] -lqwt
  # C:\Qt\6.10.1\mingw_64\include\Qwt, source_code
  INCLUDEPATH += $$[QT_INSTALL_HEADERS]/Qwt
  ```

- 可以设置环境变量: C:\Qt\6.10.1\mingw_64\bin

## 1 打包输出

- 工程配置时, 建议勾选 " 清除系统环境变量 " , 并添加如下两条用于存放临时文件, 此时不会报错

  ```bash
  TEMP=C:\Users\13455\AppData\Local\Temp
  TMP=C:\Users\13455\AppData\Local\Temp
  ```

  

- 需要安装QtInstallerFramework组件, 在包管理处选择即可

- 可以手动设置环境变量: C:\Qt\Tools\QtInstallerFramework\4.10\bin

- 文件夹的模板详见[installer_template](./installer_template)

  - config文件需要仿照撰写
  - package文件需要仿照撰写
  - exe目标文件需要放到data中

- 利用windeployqt来引入目标所需的dll文件

  - 可能不全, 不全的需要一个个手动添加

    ```bash
    windeployqt serialplot.exe
    ```

- 而后, 利用binarycreator生成安装包

  ```bash
  binarycreator -c "./config/config.xml" -p "./packages" "serialplot_yssickjgd.exe"
  ```

## 2 代码架构说明

### 2.1 项目概述

SerialPlot是一个基于Qt6和Qwt的实时串口数据绘图软件，采用C++17开发。

**技术栈**:
- Qt 6 (Widgets, SerialPort, Network, Svg)
- Qwt 6.3 (绘图库)
- CMake 3.16+ (构建系统)
- C++17

### 2.2 核心架构

项目采用**Source-Sink模式**处理数据流：

```
串口 → Reader(Source) → Stream(Sink) → PlotManager → 绘图显示
                           ↓
                    DataRecorder (CSV导出)
```

**关键设计模式**:
1. **Source-Sink**: 数据生产者-消费者模式
2. **MVC**: Model-View-Controller (ChannelInfoModel, UI组件, MainWindow)
3. **工厂模式**: Reader类型创建
4. **观察者模式**: 信号槽机制

### 2.3 核心模块

#### 数据流核心
- `Source/Sink`: 数据流抽象基类
- `AbstractReader`: 数据读取器基类
  - `BinaryStreamReader`: 二进制格式 (int8/16/32, float)
  - `AsciiReader`: ASCII/CSV格式
  - `FramedReader`: 帧格式 (支持校验)
  - `DemoReader`: 演示模式
- `Stream`: 核心数据流管理
- `StreamChannel`: 单通道数据
- 缓冲系统: `RingBuffer`, `IndexBuffer`, `FrameBuffer`

#### 绘图可视化
- `Plot`: 主绘图类 (基于QwtPlot)
- `PlotManager`: 绘图管理器 (单图/多图)
- `Zoomer/ScaleZoomer`: 缩放工具
- `BarPlot`: 柱状图

#### 用户界面
- `MainWindow`: 主窗口
- `PortControl`: 串口控制
- `DataFormatPanel`: 数据格式选择
- `PlotControlPanel`: 绘图控制
- `CommandPanel`: 命令发送
- `RecordPanel`: 数据记录

#### 功能模块
- `DataRecorder`: CSV数据记录
- `SnapshotManager`: 快照管理
- `UpdateChecker`: 版本更新检查

### 2.4 数据流详解

**读取流程**:
```
QSerialPort → AbstractReader (解析) → SamplePack
    ↓
Stream (多通道同步) → StreamChannel
    ↓
RingBuffer (环形缓冲) → FrameBufferSeries
    ↓
Plot (Qwt显示)
```

**支持的数据格式**:
1. 二进制: (u)int8/16/32, float, 支持大小端
2. ASCII: CSV格式，逗号分隔
3. 帧格式: 自定义帧头尾，带校验
4. 演示: 正弦波测试数据

### 2.5 目录结构

```
serialplot/
├── src/              # 源代码 (138个文件)
│   ├── 数据流核心    # source, sink, reader, stream, buffer
│   ├── 绘图可视化    # plot, plotmanager, zoomer
│   ├── 用户界面      # mainwindow, panels, widgets
│   ├── 功能模块      # recorder, snapshot, update
│   └── 配置定义      # defines.h, version.h
├── tests/           # 单元测试 (Catch2)
├── misc/            # 资源文件 (图标, 图片)
├── cmake/           # CMake模块
└── installer_template/  # 安装包模板
```

### 2.6 代码统计

- **源文件**: 59个 .cpp 文件
- **头文件**: 62个 .h 文件  
- **界面文件**: 17个 .ui 文件
- **总代码量**: 约15,000+行

### 2.7 扩展点

1. **新数据格式**: 继承`AbstractReader`，实现`readData()`
2. **自定义绘图**: 基于Qwt扩展Plot
3. **数据分析**: 添加新的Sink实现
4. **插件系统**: 可考虑动态加载Reader

### 2.8 详细文档

完整的代码分析文档请参考：
- [代码架构文档.md](./代码架构文档.md) - 完整架构设计说明
- [src代码组织.md](./src代码组织.md) - 源代码文件详细分类

  





